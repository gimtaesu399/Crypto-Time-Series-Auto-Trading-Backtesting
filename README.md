# Crypto Time-Series Auto Trading & Backtesting

시계열 데이터 기반으로  
1) 비트코인 자동매매 전략을 설계하고,  
2) 백테스팅으로 지속적으로 개선하며,  
3) 머신러닝/딥러닝 모델로 매매 확률을 추정하고,  
4) 그 확률을 이용해 모의 매매(paper trading)를 수행하는  
연구 + 실전용 프로젝트.

현재 단계: **설계 및 계획 단계(아직 코드 작성 전)**  
이 레포는 프로젝트 전체 설계, 로드맵, 고려사항들을 정리해 두기 위한 용도이다.

---

## 1. 프로젝트 목표

### 1.1 기술적 목표

- 시계열 데이터(코인 가격/거래량 등)를 안정적으로 수집·저장하는 파이프라인 구축
- 백테스팅 엔진 구현
  - 슬리피지, 수수료, 주문 체결 로직까지 포함한 “현실적인” 시뮬레이터
- 규칙 기반 전략(Rule-based strategy)을 먼저 설계·개선
- 이후 머신러닝/딥러닝 모델을 도입해
  - “특정 시점에 매수/매도할 확률” 또는
  - “다음 구간 수익률”을 예측하는 모델 구축
- 모델 출력(확률/수익률)을 실제 매매 로직에 연결하여 모의 매매 수행

### 1.2 연구/전략적 목표

- 단순히 “수익률이 잘 나오는 전략”을 넘어,
  - 어느 상황에서 잘 되고,
  - 어떤 시장 조건에서 깨지는지,
  - 어떤 지표들이 의미 있는지를 분석
- “전략 개선 사이클”을 명시적으로 설계
  - 아이디어 → 전략 구현 → 백테스트 → 분석 → 개선 → 반복
- 나중에 논리적으로 설명 가능한 수준의 전략/모델을 만드는 것
  - “왜 이 전략이 이 상황에서 동작하는가?”를 말로 설명할 수 있는 상태

---

## 2. 전체 시스템 아키텍처 (Draft)

### 2.1 단계별 구조

1. **데이터 수집(Data Ingestion)**
   - 거래소 API / 히스토리 데이터에서:
     - 시가, 고가, 저가, 종가(OHLC)
     - 거래량
     - 심리/파생 지표(선물 Funding Rate, Open Interest 등은 나중에 고려)
   - 다양한 시간 단위:
     - 1분봉, 5분봉, 15분봉, 1시간봉, 4시간봉, 일봉 등 중 목표 주기로 결정

2. **데이터 저장 및 전처리**
   - DB or Parquet/CSV 형태로 저장 (초기에는 파일, 나중에 DB로 확장)
   - 결측값 처리
   - 스플릿(Train/Validation/Test) 시 시간 순서를 지키는 구조

3. **지표 계산(Feature Engineering)**
   - Moving Averages (SMA/EMA), RSI, MACD, Bollinger Bands 등
   - 변동성(Volatility), 로그 수익률(log return), 롤링 통계치 등
   - 향후 딥러닝 모델 입력으로도 쓰일 예정

4. **백테스팅 엔진(Backtesting Engine)**
   - 지정한 전략을 주어진 기간의 데이터에 대해 실행
   - 가상의 포트폴리오 상태를 매 시점 업데이트
   - 수수료, 슬리피지, 최소 거래단위, 레버리지 등을 반영

5. **전략 레이어(Strategy Layer)**
   - 규칙 기반 전략: 지표 조합으로 매수/매도 신호 생성
   - 모델 기반 전략: ML/DL 모델의 출력(상승 확률, 기대 수익률)을 사용해 의사결정

6. **모델 레이어(Model Layer, 이후 단계)**
   - Input: 시계열 창(window) + 지표
   - Output: 
     - 다음 N분/시간 동안 양의 수익률일 확률,
     - 혹은 다음 캔들의 수익률 값 회귀
   - 예시 모델:
     - LSTM/GRU, Temporal Conv, Transformer 계열 등

7. **모의 매매(Paper Trading) / 실시간 시뮬레이션**
   - 실제 시장 데이터를 스트리밍/폴링하며,
   - 이전에 학습한 전략/모델을 이용해 가상의 주문 실행
   - 성능 모니터링 및 로그 저장

---

## 3. 설계 로드맵 (Plan)

### Phase 0: 리포지토리 셋업 및 기본 구조

- [ ] `README.md` 에 설계/계획 정리 (현재 단계)
- [ ] 기본 디렉토리 구조 생성 (예시 아래 참고)
- [ ] Python 환경 / requirements.txt 대략 정의

### Phase 1: 데이터 파이프라인

- [ ] 대상 거래소 및 코인 페어 선정 (예: BTC/USDT, ETH/USDT 등)
- [ ] 특정 구간의 히스토리 데이터 수집 스크립트 작성
- [ ] 저장 형식 결정 (초기: CSV/Parquet, 이후: DB)
- [ ] 전처리/유효성 검증 로직 작성
  - 이상치 제거, 결측 처리, timezone 정리

### Phase 2: Rule-based 전략 + 백테스트 엔진

- [ ] 간단한 전략부터 시작
  - 예: 이동평균 크로스오버, 볼린저 밴드 터치, RSI 과매수/과매도 등
- [ ] 백테스팅 엔진 설계
  - 포지션 상태(보유 여부, 수량, 평균 매수가 등)
  - 주문 체결 로직 (시장가 기준, 슬리피지 반영)
  - 수수료 반영
- [ ] 성능 지표 구현
  - 총 수익률, MDD(Max Drawdown), 승률, 샤프 비율 등 (필요한 것부터)

### Phase 3: 전략 개선 사이클 확립

- [ ] “전략 아이디어 → 구현 → 백테스트 → 분석” 프로세스 문서화
- [ ] 전략별 성능 로그 및 리포트 자동 생성
- [ ] 시장 구간별(상승장/하락장/횡보장) 성능 비교

### Phase 4: 모델 기반 접근(Model-based Trading)

- [ ] 예측하고 싶은 대상 정의
  - 예: 다음 1시간 수익률 > 0인지 (binary classification)
  - 혹은 N분 후 가격이 현재 대비 +X% 이상인지
- [ ] 피쳐 설계
  - 과거 N개 캔들, 각종 지표, 거래량, 변동성 등
- [ ] 학습/검증/테스트 분리 (시간 순서 유지)
- [ ] 기본 모델부터 시도
  - Logistic Regression, Random Forest, XGBoost 등
  - 이후 LSTM/GRU/Temporal 모델로 확장
- [ ] 모델 출력(확률)을 전략 로직과 연결
  - 예: 상승 확률 > 0.6일 때만 매수, 손절/익절 규칙 추가

### Phase 5: 모의 매매(Paper Trading) 및 모니터링

- [ ] 실시간(또는 지연 데이터) 기준으로 모의 매매 환경 구현
- [ ] 전략/모델이 실시간으로 어떻게 동작하는지 관찰
- [ ] 실시간과 백테스트 결과의 괴리 분석
  - 슬리피지/체결 딜레이/데이터 지연 등 원인 분석

---

## 4. 디렉토리 구조 (초안)

```bash
crypto-autotrade/
  ├── data/
  │     ├── raw/          # 원본 시계열 데이터 (CSV/Parquet)
  │     └── processed/    # 전처리 후 데이터
  ├── notebooks/          # 실험/아이디어용 Jupyter 노트북
  ├── src/
  │     ├── data/         # 데이터 수집, 전처리 스크립트
  │     ├── features/     # 지표 계산, feature engineering
  │     ├── backtest/     # 백테스트 엔진
  │     ├── strategies/   # 규칙 기반/모델 기반 전략 모듈
  │     ├── models/       # ML/DL 모델 정의, 학습 코드
  │     └── utils/        # 공통 유틸 함수
  ├── reports/
  │     ├── backtest/     # 백테스트 결과 리포트 (그래프, 표 등)
  │     └── experiments/  # 모델 실험 결과 정리
  ├── requirements.txt
  └── README.md
